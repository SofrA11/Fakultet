CREATE TABLE BIBLIOTEKA
(   
ID NUMBER(10),
NAZIV VARCHAR2(30),
CONSTRAINT BIBLIOTEKA_PK PRIMARY KEY (ID)
);

Insert into BIBLIOTEKA (ID,NAZIV) values (2,'Biblioteka Mediana');
Insert into BIBLIOTEKA (ID,NAZIV) values (3,'Biblioteka Svetozar Markovic');
Insert into BIBLIOTEKA (ID,NAZIV) values (4,'Biblioteka Sv.Naum');
Insert into BIBLIOTEKA (ID,NAZIV) values (5,'Biblioteka Matice Srpske');
Insert into BIBLIOTEKA (ID,NAZIV) values (6,'Biblioteka Krusevac');
Insert into BIBLIOTEKA (ID,NAZIV) values (1,'Narodna biblioteka');


CREATE TABLE KNJIGA 
(	
    ISBN NUMBER(10) NOT NULL ENABLE, 
    NASLOV VARCHAR2(30) NOT NULL ENABLE, 
    DATUM_OBJAVLJIVANJA DATE, 
    CONSTRAINT KNJIGA_PK PRIMARY KEY (ISBN)
);

Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (1234567892,'Beli Tigar',to_timestamp('12-MAR-75','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (3,'Znakovi',to_timestamp('23-MAY-79','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (4,'Prokleta avlija',to_timestamp('05-OCT-69','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (5,'Led',to_timestamp('30-JUL-81','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (6,'Deca',to_timestamp('17-JAN-77','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (7,'Vreme smrti',to_timestamp('27-OCT-79','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (8,'Gresnik',to_timestamp('28-OCT-83','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (9,'Izabrana dela',to_timestamp('30-OCT-89','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (10,'Mrtvo more',to_timestamp('01-NOV-69','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (11,'Dozivljaji Nikoletine Bursaca',to_timestamp('03-NOV-99','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (12,'Orlovi rano lete',to_timestamp('04-NOV-79','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (13,'Djecak prati zmaja',to_timestamp('04-NOV-81','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (14,'Ocevi i oci',to_timestamp('04-NOV-83','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (15,'Cekajuci Godoa',to_timestamp('08-NOV-50','DD-MON-RR HH.MI.SSXFF AM'));
Insert into KNJIGA (ISBN,NASLOV,DATUM_OBJAVLJIVANJA) values (1234567891,'Na drini cuprija',to_timestamp('08-NOV-72','DD-MON-RR HH.MI.SSXFF AM'));


CREATE TABLE KNJIGA_U_BIBLIOTECI
(	
  ID_BIBLIOTEKE NUMBER(10), 
	ISBN_KNJIGE NUMBER(10), 
	KOLICINA NUMBER(3) NOT NULL CHECK(KOLICINA > 0), 
	CONSTRAINT KNJIGA_U_BIBLIOTECI_PK PRIMARY KEY (ID_BIBLIOTEKE, ISBN_KNJIGE),
  CONSTRAINT KNJIGA_FK FOREIGN KEY (ISBN_KNJIGE) REFERENCES KNJIGA (ISBN), 
  CONSTRAINT BIBLIOTEKA_FK FOREIGN KEY (ID_BIBLIOTEKE) REFERENCES BIBLIOTEKA (ID)
);

Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,1234567892,2);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,3,4);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,4,7);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,10,4);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,9,1);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,8,3);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,5,9);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,14,4);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,15,4);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,13,6);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,12,8);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,11,3);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,10,5);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,9,2);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,8,1);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,7,6);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (2,3,2);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,10,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,9,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,8,11);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,7,9);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,6,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,5,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,4,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,3,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (4,1234567891,10);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,1234567892,8);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,1234567891,8);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,3,8);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,4,5);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,5,5);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,15,7);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,14,9);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (3,13,2);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,1234567892,1);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,1234567891,2);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,8,3);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,7,4);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,6,5);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,9,6);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,10,7);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,12,8);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (5,14,9);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,12,12);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,13,11);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,15,2);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,11,3);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,6,5);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,8,4);
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (6,3,7); 
Insert into KNJIGA_U_BIBLIOTECI (ID_BIBLIOTEKE,ISBN_KNJIGE,KOLICINA) values (1,1234567891,6);

1.
--KREIRANJE UPITA
CREATE VIEW IMA_PROKLETU_AVLIJU
AS SELECT BIBLIOTEKA.NAZIV 
FROM BIBLIOTEKA INNER JOIN KNJIGA_U_BIBLIOTECI ON BIBLIOTEKA.ID=KNJIGA_U_BIBLIOTECI.ID_BIBLIOTEKE INNER JOIN KNJIGA ON KNJIGA.ISBN=KNJIGA_U_BIBLIOTECI.ISBN_KNJIGE
WHERE KNJIGA.NASLOV='Prokleta avlija';

--DUGI DEO ZADATKA
SELECT NAZIV 
FROM IMA_PROKLETU_AVLIJU
WHERE KOLICINA =(SELECT MAX(KOLICINA) FROM IMA_PROKLETU_AVLIJU)

2.
INSERT INTO KNJIGA 
(ISBN,NASLOV,DATUM_OBJAVLJIVANJA)
VALUES(100,'Ljubav u doba kolere','1-JAN-10')

3.
UPDATE KNJIGA_U_BIBLIOTECI
SET KOLICINA = KOLICINA - 3
WHERE ID_BIBLIOTEKE = (SELECT ID FROM BIBLIOTEKA WHERE NAZIV = 'Biblioteka Sv.Naum')
 AND ISBN_KNJIGE = (SELECT ISBN FROM KNJIGA WHERE NASLOV = 'Prokleta avlija');
 
INSERT INTO KNJIGA_U_BIBLIOTECI
VALUES((SELECT ID FROM BIBLIOTEKA WHERE NAZIV = 'Biblioteka Krusevac'),
 (SELECT ISBN FROM KNJIGA WHERE NASLOV = 'Prokleta avlija'), 3);
 
4.
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Oracle.ManagedDataAccess.Client;

namespace ConsoleApp2
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                string strCon = "Data Source=160.99.12.92/GISLAB_PD; User Id=S6969; Password=LoL;";
                OracleConnection con = new OracleConnection(strCon);
                string naslovStr;
                Console.WriteLine("Unesi naslov ");
                naslovStr = Console.ReadLine();
                con.Open();

                string komanda = "SELECT NAZIV FROM BIBLIOTEKA INNER JOIN KNJIGA_U_BIBLIOTECI ON ID=ID_BIBLIOTEKE INNER JOIN KNJIGA ON ISBN=ISBN_KNJIGE"
                    + " WHERE NASLOV='" + naslovStr + "'";
                OracleCommand cmd = new OracleCommand(komanda, con);

                OracleDataReader r = cmd.ExecuteReader();
                while (r.Read())
                {
                    string strBiblioteka;
                    strBiblioteka = r.GetString(0);
                    Console.WriteLine(strBiblioteka);
                }
                r.Close();
            }
            catch (Exception ex)
            {
                Console.WriteLine("Doslo je do greske prilikom pristupanja bazi podataka: " + ex.Message);
            }
        }
    }
}

